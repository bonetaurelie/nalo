{% form_theme form with ['bootstrap_3_horizontal_layout.html.twig', 'Form/fields.html.twig'] %}
{# personnalise la taille du champ nb d'individu #}
{% form_theme form _self %}
{% block integer_widget %}
    <div class="col-lg-1 no-padding">
        {% set type = type|default('number') %}
        {{ block('form_widget_simple') }}
    </div>
{% endblock %}

{{ form_start(form) }}
{% trans_default_domain 'AppBundle' %}
<div class="row">
    <div class="col-lg-12">
        {{ form_row(form.datetimeObservation) }}
        {{ form_row(form.department)}}
        {{ form_row(form.locality) }}
        {{ form_row(form.species) }}
        {{ form_row(form.nbIndividual) }}
        {{ form_row(form.comment) }}
    </div>
    <div class="col-lg-12">
        <h2>{{ 'observations.form.image.title'|trans }}</h2>
        <ul class="images" id="observation_images" data-prototype="{{ form_widget(form.images.vars.prototype)|e('html_attr') }}">
            {% for image in form.images %}
                <li>
                    <div class="row">
                        <h3 class="col-lg-6">{{ 'observations.form.image.label'|trans }} {{ loop.index }}</h3>
                        <div class="col-lg-6 text-right">
                            <a href="#" class="delete-image btn btn-danger">{{ 'observations.form.image.delete_btn'|trans }}</a>
                        </div>
                    </div>
                    {{ form_row(image.alt, {'label_attr': {'class': 'col-lg-4'}}) }}
                    {{ form_row(image.file, {'label_attr': {'class': 'col-lg-4'}}) }}
                </li>
            {% endfor %}
        </ul>
        <a href="#" id="add-another-image" class="btn-large btn-default pull-right">{{ 'observations.form.image.add_btn'|trans }}</a>
    </div>
    <div class="col-lg-12">
        <button type="submit" class="btn btn-default">{{ 'observations.form.add_submit'|trans }}</button>
    </div>
</div>

{{ form_end(form) }}
<script type="text/javascript">
    $(function(){
        var $container = $('#observation_images');
        var index = $container.find('li').length;

        $('#add-another-image').click(function(e){
            addImage($container);

            e.preventDefault();

            return false;
        });

        if (index == 0) {
            addImage($container);
        }

        function addImage($container)
        {
            var dataPrototype = $container.attr('data-prototype').replace(/__name__/g, index);

            var template = '<li>' +
                                '<div class="row">' +
                                    '<h3 class="col-lg-6">{{ 'observations.form.image.label'|trans|e('js') }} '+(index+1)+'</h3>' +
                                    '<div class="col-lg-6 text-right">'+
                                        '<a href="#" class="delete-image btn btn-danger">{{ 'observations.form.image.delete_btn'|trans|e('js') }}</a>'+
                                    '</div>' +
                                '</div>' +
                                dataPrototype+
                            '</li>';


            var $prototype = $(template);

            $container.append($prototype);

            // IncrÃ©mentation du compteur de photo
            index++;

            displayOrNotAddImage();
        }

        $(document).on('click', '.delete-image', function(e){
            bootbox.dialog({
                message: '{{ 'observations.form.image.delete_confirm_message'|trans|e('js') }}',
                title: 'Question',
                buttons:{
                    cancel:{
                        label: 'Annuler'
                    },
                    delete:{
                        label: 'Supprimer',
                        className: 'btn btn-danger',
                        callback: function(){
                            $(this).parents('li').remove();
                            displayOrNotAddImage();
                        }
                    }
                }
            });

            e.preventDefault();
            return false;
        });

        /**
         * Limite le nombre d'ajout de photos
         */
        function displayOrNotAddImage(){
            var nbElements = $container.find('li').length;

            if(nbElements > 3){
                $('#add-another-image').css('display', 'none');
            }
        }
    });
</script>